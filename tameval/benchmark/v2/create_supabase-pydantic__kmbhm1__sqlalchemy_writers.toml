[meta]
task = "create"
scenario = "extend_test_file"

[lang_info]
lang = "Python"
python_version = "3.13"
python_cfg_file = "pyproject.toml"

[repo_info]
repository = "kmbhm1/supabase-pydantic"
sha = "0a62448b7c42eef16ec885ccedaebe42a51f9fbf"

[run_info]
docker_image = "python:3.13"
volumes_to_mount = [ "{proj_path}:/app", "{host}/.m2:/.m2", "{host}/.cache/pip:/.pip_cache", "{host}/.cache/go-build:/.go_cache", "{proj_path}/_HOME_/go:/go",]
docker_wrap = "sudo docker run --rm -w /app -e PATH=_HOME_/.local/bin:$PATH -e PYTHONUSERBASE=_HOME_/.local/ -v {proj_path}:/app -v {host}/.m2:/.m2 -v {host}/.cache/pip:/.pip_cache -v {host}/.cache/go-build:/.go_cache -v {proj_path}/_HOME_/go:/go {img} sh -c '{cmd}'"
env = [ "PATH=_HOME_/.local/bin:$PATH", "PYTHONUSERBASE=_HOME_/.local/",]
prebuild_command = "pip install -r requirements.txt && (pip install .[all,test] && pip install git+https://github.com/Klema17/mutpy.git && pip install coverage pytest pytest_cov covdefaults Cython mock ddt pytest_mock testfixtures)"
test_run_command = "coverage run --include=supabase_pydantic/util/writers/sqlalchemy_writers.py -m pytest -q --junit-xml=test_output.xml tests/unit/writers/test_sqlalchemy_writers.py && coverage xml -o coverage.xml --fail-under=0"
mutation_run_command = "mut.py --target supabase_pydantic.util.writers.sqlalchemy_writers --unit-test tests.unit.writers.test_sqlalchemy_writers --runner pytest --report mutation_report.yaml"
mutation_run_command_fallback = "mut.py --target supabase_pydantic/util/writers/sqlalchemy_writers.py --unit-test tests/unit/writers/test_sqlalchemy_writers.py --runner pytest --report mutation_report.yaml"
coverage_report_path = "coverage.xml"
coverage_report_type = "cobertura"
mutation_report_path = "mutation_report.yaml"
mutation_report_type = "mutpy"

[coverage]
coverage = 98.0
original_coverage = 98.0
mutation_kill_rate = 94.0
original_mutation_kill_rate = 94.0
covered_lines = [ 0, 2, 4, 5, 6, 7, 8, 13, 14, 17, 18, 19, 23, 25, 27, 29, 31, 33, 34, 36, 39, 40, 41, 42, 43, 44, 47, 48, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 61, 63, 65, 67, 68, 70, 72, 73, 74, 75, 77, 83, 84, 85, 86, 87, 88, 89, 91, 92, 93, 94, 97, 107, 110, 111, 112, 114, 115, 116, 117, 122, 123, 124, 126, 129, 130, 131, 132, 133, 135, 136, 137, 138, 143, 144, 145, 147, 149, 150, 151, 152, 153, 155, 157, 159, 171, 172, 173, 175, 176, 177, 178, 180, 181, 183, 185, 186, 188, 189, 190, 192, 194, 195, 196, 197, 198, 199, 202, 205, 206, 207, 208, 209, 210, 213, 214, 215, 216, 217, 218, 220, 223, 224, 231, 233, 235, 241, 242, 244, 249, 250, 253, 255, 258, 265, 266, 269, 271, 272, 273, 275, 277, 285, 286, 287, 288, 290, 291, 293, 296, 298, 300, 302, 305, 310, 312, 314, 316,]
missed_lines = [ 60, 95, 294,]

[input_info]
test_file_path = "tests/unit/writers/test_sqlalchemy_writers.py"
focal_file_path = "supabase_pydantic/util/writers/sqlalchemy_writers.py"
test_file_url = "https://github.com/kmbhm1/supabase-pydantic/blob/0a62448b7c42eef16ec885ccedaebe42a51f9fbf/tests/unit/writers/test_sqlalchemy_writers.py"
focal_file_url = "https://github.com/kmbhm1/supabase-pydantic/blob/0a62448b7c42eef16ec885ccedaebe42a51f9fbf/supabase_pydantic/util/writers/sqlalchemy_writers.py"
first_commit_date = "2024-07-26"
last_commit_date = "2025-02-16"
test_file_content = "import pytest\n\nfrom supabase_pydantic.util.constants import RelationType\nfrom supabase_pydantic.util.dataclasses import ColumnInfo, ConstraintInfo, ForeignKeyInfo, RelationshipInfo, TableInfo\nfrom supabase_pydantic.util.writers.sqlalchemy_writers import SqlAlchemyFastAPIClassWriter, SqlAlchemyFastAPIWriter\n\n\n@pytest.fixture\ndef table_info():\n    \"\"\"Return a TableInfo instance for testing.\"\"\"\n    return TableInfo(\n        name='User',\n        schema='public',\n        columns=[\n            ColumnInfo(name='id', post_gres_datatype='integer', is_nullable=False, primary=True, datatype='int'),\n            ColumnInfo(name='email', post_gres_datatype='varchar', is_nullable=True, datatype='str'),\n            ColumnInfo(name='company_id', post_gres_datatype='uuid', is_nullable=False, datatype='UUID'),\n        ],\n        foreign_keys=[\n            ForeignKeyInfo(\n                constraint_name='User_company_id_fkey',\n                column_name='company_id',\n                foreign_table_name='Company',\n                foreign_column_name='id',\n                relation_type=RelationType.ONE_TO_ONE,\n            ),\n        ],\n        constraints=[\n            ConstraintInfo(\n                constraint_name='User_pkey',\n                raw_constraint_type='p',\n                columns=['id'],\n                constraint_definition='PRIMARY KEY (id)',\n            ),\n        ],\n    )\n\n\n@pytest.fixture\ndef tables(table_info):\n    \"\"\"Return a list of TableInfo instances for testing.\"\"\"\n    return [\n        table_info,\n        TableInfo(\n            name='Company',\n            schema='public',\n            columns=[\n                ColumnInfo(name='id', post_gres_datatype='uuid', is_nullable=False, primary=True, datatype='UUID'),\n                ColumnInfo(name='name', post_gres_datatype='varchar', is_nullable=False, datatype='str'),\n            ],\n            foreign_keys=[],\n            constraints=[\n                ConstraintInfo(\n                    constraint_name='Company_pkey',\n                    raw_constraint_type='p',\n                    columns=['id'],\n                    constraint_definition='PRIMARY KEY (id)',\n                ),\n            ],\n        ),\n        TableInfo(\n            name='Client',\n            schema='public',\n            columns=[\n                ColumnInfo(name='id', post_gres_datatype='uuid', is_nullable=False, primary=True, datatype='UUID'),\n                ColumnInfo(name='name', post_gres_datatype='varchar', is_nullable=False, datatype='str'),\n                ColumnInfo(name='info_json', post_gres_datatype='jsonb', is_nullable=True, datatype='dict'),\n            ],\n            foreign_keys=[],\n            constraints=[\n                ConstraintInfo(\n                    constraint_name='Client_pkey',\n                    raw_constraint_type='p',\n                    columns=['id'],\n                    constraint_definition='PRIMARY KEY (id)',\n                ),\n            ],\n        ),\n    ]\n\n\n@pytest.fixture\ndef blog_tables():\n    \"\"\"Return a list of TableInfo instances for testing relationships.\"\"\"\n    return [\n        TableInfo(\n            name='User',\n            schema='public',\n            columns=[\n                ColumnInfo(name='id', post_gres_datatype='uuid', is_nullable=False, primary=True, datatype='UUID'),\n                ColumnInfo(name='email', post_gres_datatype='varchar', is_nullable=False, datatype='str'),\n                ColumnInfo(name='profile_id', post_gres_datatype='uuid', is_nullable=True, datatype='UUID'),\n            ],\n            foreign_keys=[\n                ForeignKeyInfo(\n                    constraint_name='User_profile_id_fkey',\n                    column_name='profile_id',\n                    foreign_table_name='Profile',\n                    foreign_column_name='id',\n                    relation_type=RelationType.ONE_TO_ONE,\n                ),\n            ],\n            relationships=[\n                RelationshipInfo(\n                    table_name='user',\n                    related_table_name='post',\n                    relation_type=RelationType.ONE_TO_MANY,\n                ),\n            ],\n        ),\n        TableInfo(\n            name='Profile',\n            schema='public',\n            columns=[\n                ColumnInfo(name='id', post_gres_datatype='uuid', is_nullable=False, primary=True, datatype='UUID'),\n                ColumnInfo(name='bio', post_gres_datatype='text', is_nullable=True, datatype='str'),\n            ],\n            relationships=[\n                RelationshipInfo(\n                    table_name='profile',\n                    related_table_name='user',\n                    relation_type=RelationType.ONE_TO_ONE,\n                ),\n            ],\n        ),\n        TableInfo(\n            name='Post',\n            schema='public',\n            columns=[\n                ColumnInfo(name='id', post_gres_datatype='uuid', is_nullable=False, primary=True, datatype='UUID'),\n                ColumnInfo(name='title', post_gres_datatype='varchar', is_nullable=False, datatype='str'),\n                ColumnInfo(name='author_id', post_gres_datatype='uuid', is_nullable=False, datatype='UUID'),\n            ],\n            foreign_keys=[\n                ForeignKeyInfo(\n                    constraint_name='Post_author_id_fkey',\n                    column_name='author_id',\n                    foreign_table_name='User',\n                    foreign_column_name='id',\n                    relation_type=RelationType.ONE_TO_MANY,\n                ),\n            ],\n            relationships=[\n                RelationshipInfo(\n                    table_name='post',\n                    related_table_name='comment',\n                    relation_type=RelationType.ONE_TO_MANY,\n                ),\n                RelationshipInfo(\n                    table_name='post',\n                    related_table_name='tag',\n                    relation_type=RelationType.MANY_TO_MANY,\n                ),\n            ],\n        ),\n    ]\n\n\n@pytest.fixture\ndef fastapi_class_writer(table_info):\n    \"\"\"Return a SqlAlchemyFastAPIClassWriter instance.\"\"\"\n    return SqlAlchemyFastAPIClassWriter(table_info)\n\n\n@pytest.fixture\ndef fastapi_writer(tables):\n    \"\"\"Return a SqlAlchemyFastAPIWriter instance.\"\"\"\n    return SqlAlchemyFastAPIWriter(tables, 'made-up-file-path.py')\n\n\ndef test_SqlAlchemyFastAPIClassWriter_write_name(fastapi_class_writer):\n    \"\"\"Verify the write_name method returns the expected value.\"\"\"\n    assert fastapi_class_writer.write_name() == 'User'\n\n\ndef test_SqlAlchemyFastAPIClassWriter_write_metaclass_returns_Base(fastapi_class_writer):\n    \"\"\"Verify the write_metaclass method returns the expected value.\"\"\"\n    assert fastapi_class_writer.write_metaclass() == 'Base'\n    assert fastapi_class_writer.write_metaclass('foo') == 'Base'\n\n\ndef test_SqlAlchemyFastAPIClassWriter_write_docs(fastapi_class_writer):\n    \"\"\"Verify the write_docs method returns the expected value.\"\"\"\n    assert fastapi_class_writer.write_docs() == '\\n\\t\"\"\"User Base.\"\"\"\\n\\n\\t__tablename__ = \"User\"\\n'\n\n\ndef test_SqlAlchemyFastAPIClassWriter_write_column(fastapi_class_writer):\n    \"\"\"Verify the write_column method returns expected values.\"\"\"\n    assert (\n        fastapi_class_writer.write_column(\n            ColumnInfo(name='id', post_gres_datatype='integer', is_nullable=False, primary=True, datatype='int')\n        )\n        == 'id: Mapped[int] = mapped_column(Integer, primary_key=True)'\n        and fastapi_class_writer.write_column(\n            ColumnInfo(name='id', post_gres_datatype='integer', is_nullable=False, primary=True, datatype='int')\n        )\n        != 'id = Column(Integer, primary_key=True)'\n    )\n    assert (\n        fastapi_class_writer.write_column(\n            ColumnInfo(name='email', post_gres_datatype='varchar', is_nullable=True, datatype='str')\n        )\n        == 'email: Mapped[str | None] = mapped_column(String)'\n        and fastapi_class_writer.write_column(\n            ColumnInfo(name='email', post_gres_datatype='varchar', is_nullable=True, datatype='str')\n        )\n        != 'email = Column(String, nullable=True)'\n    )\n    assert (\n        fastapi_class_writer.write_column(\n            ColumnInfo(name='company_id', post_gres_datatype='uuid', is_nullable=False, datatype='UUID')\n        )\n        == 'company_id: Mapped[UUID4] = mapped_column(UUID(as_uuid=True), ForeignKey(\"Company.id\"))'\n        and fastapi_class_writer.write_column(\n            ColumnInfo(name='company_id', post_gres_datatype='uuid', is_nullable=False, datatype='UUID')\n        )\n        != 'company_id = Column(UUID(as_uuid=True), ForeignKey(\"Company.id\"))'\n    )\n    assert (\n        fastapi_class_writer.write_column(\n            ColumnInfo(\n                name='created_at', post_gres_datatype='timestamp with time zone', is_nullable=False, datatype='datetime'\n            )\n        )\n        == 'created_at: Mapped[datetime] = mapped_column(TIMESTAMP(timezone=True))'\n        and fastapi_class_writer.write_column(\n            ColumnInfo(\n                name='created_at', post_gres_datatype='timestamp with time zone', is_nullable=False, datatype='datetime'\n            )\n        )\n        != 'created_at = Column(TIMESTAMP(timezone=True))'\n    )\n    assert (\n        fastapi_class_writer.write_column(\n            ColumnInfo(\n                name='unique_string', post_gres_datatype='varchar', is_nullable=False, is_unique=True, datatype='str'\n            )\n        )\n        == 'unique_string: Mapped[str] = mapped_column(String, unique=True)'\n        and fastapi_class_writer.write_column(\n            ColumnInfo(\n                name='unique_string', post_gres_datatype='varchar', is_nullable=False, is_unique=True, datatype='str'\n            )\n        )\n        != 'unique_string = Column(String, unique=True)'\n    )\n    assert (\n        fastapi_class_writer.write_column(\n            ColumnInfo(\n                name='data_only',\n                post_gres_datatype='jsonb',\n                is_nullable=False,\n                is_unique=False,\n                primary=False,\n                datatype='dict',\n            )\n        )\n        == 'data_only: Mapped[dict | Json] = mapped_column(JSONB)'\n        and fastapi_class_writer.write_column(\n            ColumnInfo(\n                name='data_only',\n                post_gres_datatype='jsonb',\n                is_nullable=False,\n                is_unique=False,\n                primary=False,\n                datatype='dict',\n            )\n        )\n        != 'data_only = Column(JSONB)'\n    )\n\n\ndef test_SqlAlchemyFastAPIClassWriter_write_primary_keys(fastapi_class_writer):\n    \"\"\"Verify the write_primary_keys method returns the expected value.\"\"\"\n    assert (\n        fastapi_class_writer.write_primary_keys()\n        == '\\t# Primary Keys\\n\\tid: Mapped[int] = mapped_column(Integer, primary_key=True)'\n    )\n\n\ndef test_SqlAlchemyFastAPIClassWriter_write_foreign_columns(fastapi_class_writer):\n    \"\"\"Verify the write_foreign_columns method returns the expected value.\"\"\"\n    expected_value = \"\\t# Table Args\\n\\t__table_args__ = (\\n\\t\\tPrimaryKeyConstraint('id', name='User_pkey'),\\n\\t\\t{ 'schema': 'public' }\\n\\t)\\n\\n\\t# Relationships\\n\\tcompany: Mapped[Company | None] = relationship(\\\"Company\\\", back_populates=\\\"users\\\", uselist=False)\\n\"\n    assert fastapi_class_writer.write_foreign_columns() == expected_value\n\n\ndef test_SqlAlchemyFastAPIClassWriter_write_foreign_columns_relationships(blog_tables):\n    \"\"\"Verify the write_foreign_columns method handles different relationship types correctly.\"\"\"\n    # Test User model (ONE_TO_ONE with Profile, ONE_TO_MANY with Posts)\n    user_table = [t for t in blog_tables if t.name == 'User'][0]\n    user_writer = SqlAlchemyFastAPIClassWriter(user_table)\n    user_foreign_cols = user_writer.write_foreign_columns()\n\n    assert (\n        'profile: Mapped[Profile | None] = relationship(\"Profile\", back_populates=\"users\", uselist=False)'\n        in user_foreign_cols\n    )\n    assert 'posts: Mapped[list[Post]] = relationship(\"Post\", back_populates=\"users\")' in user_foreign_cols\n\n    # Test Post model (ONE_TO_MANY with Comments, MANY_TO_MANY with Tags)\n    post_table = [t for t in blog_tables if t.name == 'Post'][0]\n    post_writer = SqlAlchemyFastAPIClassWriter(post_table)\n    post_foreign_cols = post_writer.write_foreign_columns()\n\n    assert 'comments: Mapped[list[Comment]] = relationship(\"Comment\", back_populates=\"posts\")' in post_foreign_cols\n    assert 'tags: Mapped[list[Tag]] = relationship(\"Tag\", back_populates=\"posts\")' in post_foreign_cols\n\n    # Test Profile model (ONE_TO_ONE with User)\n    profile_table = [t for t in blog_tables if t.name == 'Profile'][0]\n    profile_writer = SqlAlchemyFastAPIClassWriter(profile_table)\n    profile_foreign_cols = profile_writer.write_foreign_columns()\n\n    assert (\n        'user: Mapped[User | None] = relationship(\"User\", back_populates=\"profiles\", uselist=False)'\n        in profile_foreign_cols\n    )\n\n\ndef test_SqlAlchemyFastAPIClassWriter_write_operational_class_returns_None(fastapi_class_writer):\n    \"\"\"Verify the write_operational_class method returns None.\"\"\"\n    assert fastapi_class_writer.write_operational_class() is None\n\n\ndef test_SqlAlchemyFastAPIClassWriter_write_columns(fastapi_class_writer):\n    \"\"\"Verify the write_columns method returns the expected value.\"\"\"\n    expected_value = (\n        '\\t# Primary Keys\\n\\tid: Mapped[int] = mapped_column(Integer, primary_key=True)\\n\\n\\t'\n        '# Columns\\n\\tcompany_id: Mapped[UUID4] = mapped_column(UUID(as_uuid=True), ForeignKey(\"Company.id\"))'\n        '\\n\\temail: Mapped[str | None] = mapped_column(String)\\n'\n    )\n    assert fastapi_class_writer.write_columns() == expected_value\n\n\ndef test_SqlAlchemyFastAPIWriter_write_primary_columns_returns_None_with_no_columns():\n    \"\"\"Verify the write_primary_columns method returns None when there are no columns.\"\"\"\n    new_table_no_columns = TableInfo(\n        name='NewTable',\n        schema='public',\n        columns=[],\n        foreign_keys=[],\n        constraints=[],\n    )\n    new_fastapi_class_writer = SqlAlchemyFastAPIClassWriter(new_table_no_columns)\n    assert new_fastapi_class_writer.write_primary_columns() is None\n\n\ndef test_SqlAlchemyFastAPIClassWriter_column_section_is_static():\n    \"\"\"Verify the column_section method is static and is correct.\"\"\"\n    assert SqlAlchemyFastAPIClassWriter.column_section('foo', ['bar', 'baz']) == '\\t# foo\\n\\tbar\\n\\tbaz'\n\n\ndef test_SqlAlchemyFastAPIWriter_write(fastapi_writer):\n    \"\"\"Verify the correct file output is written.\"\"\"\n    expected_value = (\n        'from pydantic import Json\\n'\n        'from pydantic import UUID4\\n'\n        'from sqlalchemy import ForeignKey\\n'\n        'from sqlalchemy import Integer\\n'\n        'from sqlalchemy import PrimaryKeyConstraint\\n'\n        'from sqlalchemy import String\\n'\n        'from sqlalchemy.dialects.postgresql import JSONB\\n'\n        'from sqlalchemy.dialects.postgresql import UUID\\n'\n        'from sqlalchemy.orm import DeclarativeBase\\n'\n        'from sqlalchemy.orm import Mapped\\n'\n        'from sqlalchemy.orm import mapped_column\\n'\n        'from sqlalchemy.orm import relationship\\n\\n\\n'\n        '# DECLARATIVE BASE\\n\\n\\n'\n        'class Base(DeclarativeBase):\\n'\n        '\\t\"\"\"Declarative Base Class.\"\"\"\\n'\n        '\\t# type_annotation_map = {}\\n\\n'\n        '\\tpass\\n\\n\\n'\n        '# BASE CLASSES\\n\\n\\n'\n        'class User(Base):\\n'\n        '\\t\"\"\"User Base.\"\"\"\\n\\n'\n        '\\t__tablename__ = \"User\"\\n\\n'\n        '\\t# Primary Keys\\n'\n        '\\tid: Mapped[int] = mapped_column(Integer, primary_key=True)\\n\\n'\n        '\\t# Columns\\n'\n        '\\tcompany_id: Mapped[UUID4] = mapped_column(UUID(as_uuid=True), ForeignKey(\"Company.id\"))\\n'\n        '\\temail: Mapped[str | None] = mapped_column(String)\\n'\n        '\\t# Relationships\\n'\n        '\\tcompany: Mapped[Company | None] = relationship(\"Company\", back_populates=\"users\", uselist=False)\\n'\n        '\\t# Table Args\\n'\n        '\\t__table_args__ = (\\n'\n        \"\\t\\tPrimaryKeyConstraint('id', name='User_pkey'),\\n\"\n        \"\\t\\t{ 'schema': 'public' }\\n\"\n        '\\t)\\n\\n\\n'\n        'class Company(Base):\\n'\n        '\\t\"\"\"Company Base.\"\"\"\\n\\n'\n        '\\t__tablename__ = \"Company\"\\n\\n'\n        '\\t# Primary Keys\\n'\n        '\\tid: Mapped[UUID4] = mapped_column(UUID(as_uuid=True), primary_key=True)\\n\\n'\n        '\\t# Columns\\n'\n        '\\tname: Mapped[str] = mapped_column(String)\\n'\n        '\\t# Table Args\\n'\n        '\\t__table_args__ = (\\n'\n        \"\\t\\tPrimaryKeyConstraint('id', name='Company_pkey'),\\n\"\n        \"\\t\\t{ 'schema': 'public' }\\n\"\n        '\\t)\\n\\n\\n'\n        'class Client(Base):\\n'\n        '\\t\"\"\"Client Base.\"\"\"\\n\\n'\n        '\\t__tablename__ = \"Client\"\\n\\n'\n        '\\t# Primary Keys\\n'\n        '\\tid: Mapped[UUID4] = mapped_column(UUID(as_uuid=True), primary_key=True)\\n\\n'\n        '\\t# Columns\\n'\n        '\\tname: Mapped[str] = mapped_column(String)\\n'\n        '\\tinfo_json: Mapped[dict | Json | None] = mapped_column(JSONB)\\n'\n        '\\t# Table Args\\n'\n        '\\t__table_args__ = (\\n'\n        \"\\t\\tPrimaryKeyConstraint('id', name='Client_pkey'),\\n\"\n        \"\\t\\t{ 'schema': 'public' }\\n\"\n        '\\t)'\n    )\n    assert fastapi_writer.write() == expected_value\n"
